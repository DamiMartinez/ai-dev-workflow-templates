# AI Agent Workflow & Rules

This document outlines the standard operating procedure for any AI assistant (like Gemini CLI, Cursor, etc.) working on a project. All actions must adhere to this workflow.

## 1. Core Workflow

1.  **Initial Action:** Upon starting any new interaction or task, your first step is to read and understand this document (`AGENTS.md`) in its entirety.

2.  **Task Analysis & Template Matching:**
    *   For any request, first check the project's templates directory (e.g., `templates/`, `@ai_docs/templates/`, or similar) to see if a specific template exists for the requested task (e.g., `002_bug_fix_template.md`, `003_code_review_template.md`, `004_git_commit_workflow.md`).
    *   If the request is to fix a bug, you **must** use the `002_bug_fix_template.md` template as your guide.
    *   If a matching template is found, you **must** follow the instructions provided within that template to execute the task.

3.  **New Feature or Development Implementation:**
    *   If the request involves creating a new feature, implementing new code, or any form of new development, you **must** use the `001_task_planning_template.md` as your guide.
    *   Your primary output will be a new, detailed task document. This document must be created as a new `.md` file inside the project's tasks folder (e.g., `tasks/`, `@ai_docs/tasks/`, or similar).
    *   The content and structure of this new task document must be generated by following the instructions laid out in `001_task_planning_template.md`.
    *   **CRITICAL:** Task documents must start directly with "1. Task Overview" - never include template headers, descriptions, or promotional content from the template file.
    *   **TASK NAMING CONVENTION:** Task files must follow the format `<task_number>_<name_of_the_task>.md` (e.g., `001_fastapi_backend_implementation.md`, `002_user_authentication.md`). Use zero-padded 3-digit numbers for proper ordering.

4.  **Context & References:**
    *   If you require additional context, documentation, code samples, or architectural guidelines for the project, consult the files located in the project's references directory (e.g., `references/`, `@ai_docs/references/`, or similar).
    *   For external library documentation, if you have access to MCPs (Model Context Protocol), prioritize using the `context7` MCP server to get accurate and up-to-date information.

## 2. Development Lifecycle

1.  **Project Setup & Verification:**
    *   **VIRTUAL ENVIRONMENT:** Always activate the project's virtual environment before starting any work (e.g., `ai-env`, `source venv/bin/activate`, `conda activate`, etc.).
    *   Before starting work, ensure the project dependencies are installed using the appropriate package manager (e.g., `poetry install`, `npm install`, `pip install -r requirements.txt`, etc.).
    *   After installation, run the test suite to confirm the project is in a stable state (e.g., `poetry run pytest`, `npm test`, `python -m pytest`, etc.).
    *   **LANGUAGE VERSION:** Use the appropriate language version as specified in the project configuration.
    *   **DEPENDENCIES:** Use the latest compatible versions of required dependencies for integrations.

2.  **Code Quality & Linting:**
    *   After making any code changes, you **must** run the appropriate code formatter for the project (e.g., `poetry run black .`, `npm run format`, `prettier --write .`, etc.). This ensures all code conforms to the project's style.

3.  **Dependency Management:**
    *   **VERSION CONSTRAINTS:** Always use minimum version constraints (>=) instead of exact versions (==) in dependency files to avoid dependency conflicts.
    *   **COMPATIBILITY:** Ensure all dependencies are compatible with each other and the project's requirements.
    *   **CONFLICT RESOLUTION:** Check for dependency conflicts between packages before finalizing requirements and test installation in a clean environment.

4.  **Implementation Standards:**
    *   **GENERIC IMPLEMENTATIONS:** Always implement generic solutions unless explicitly told to use specific tools/services.
    *   **NO ASSUMPTIONS:** Do not assume specific services (Supabase, Auth0, etc.) unless explicitly mentioned by the user.
    *   **FLEXIBLE DESIGN:** Design for flexibility and portability across different providers.
    *   **EXPLICIT REQUIREMENTS:** Only use specific tools when explicitly requested by the user.

5.  **Git Commit Guidelines:**
    *   When preparing to commit changes, you **must** use the `004_git_commit_workflow.md` template as your guide.

6.  **Security and Secrets Management:**
    *   **NEVER** log, commit, or expose secrets, API keys, or any other sensitive credentials in the code.
    *   Use environment variables or a secure secret management system for all credentials.
    *   If you encounter any hardcoded secrets, flag them to the user immediately.

7.  **Error Handling Protocol:**
    *   If any command fails (e.g., tests fail, a build breaks), immediately stop the current task.
    *   Report the command that was executed, its full output (stdout and stderr), and the error. Do not attempt to fix the issue without explicit instructions from the user.

## 3. Critical Directives

*   **CONFIRMATION REQUIRED:** You are **prohibited** from applying any code changes, modifying files, or executing the plan described in a task document until you receive explicit confirmation from the user to proceed. Your role is to prepare the plan for approval.

*   **FEEDBACK & TEMPLATE REFINEMENT:** If the user provides feedback indicating that a generated task definition is incorrect or incomplete, you are responsible for refining the original template (`.md` file in the templates directory) that was used. Incorporate the user's feedback to improve the template and prevent the same mistake in the future.
